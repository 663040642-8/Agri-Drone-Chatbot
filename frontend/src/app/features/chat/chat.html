<div class="flex flex-col h-full bg-white rounded-2xl overflow-hidden">
  <div class="p-4 border-b border-gray-200 flex items-center md:hidden">
    @if (!uiState.isSidebarOpen() && authService.isLoggedIn) {
    <button (click)="uiState.toggleSidebar()" class="p-1 rounded-lg text-emerald-600 hover:bg-gray-100"
      title="เปิดเมนู">
      <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
      </svg>
    </button>
    } @else {
      <div class="h-8"></div>
    }
  </div>
  <div class="flex-1 p-6 space-y-6 overflow-y-auto" #chatContainer>

    @if (chatHistory.length === 0 && !loading) {
    <div class="flex flex-col items-center justify-center h-full text-gray-400">
      <p class="text-xl">Chatbot พร้อมให้ความช่วยเหลือเสมอ</p>
      <p>เริ่มถามคำถามของคุณได้เลย</p>
    </div>
    }

    @for (chat of chatHistory; track $index) {
    <div class="flex justify-end">
      <div class="p-3 text-white bg-green-600 rounded-lg max-w-[75%]">
        <p>{{ chat.question }}</p>
      </div>
    </div>

    @if (chat.answer) {
    <div class="flex justify-start">
      <div class="p-3 bg-gray-100 rounded-lg max-w-[75%]">
        <p [innerHTML]="chat.answer"></p>
      </div>
    </div>
    }

    @if (chat.loading) {
    <div class="flex justify-start">
      <div class="p-3 bg-gray-100 rounded-lg">
        <div class="w-5 h-5 border-2 border-gray-300 rounded-full border-t-gray-600 animate-spin"></div>
      </div>
    </div>
    }
    }
  </div>

  <div class="p-4 bg-white border-t border-gray-200">
    <form [formGroup]="chatForm" (ngSubmit)="onSubmit()" class="flex items-center space-x-3">

      <input formControlName="question" type="text" placeholder="พิมพ์คำถามของคุณที่นี่..."
        class="flex-1 min-w-0 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
        (keydown.enter)="handleEnter($event)" />

      <button type="submit" [disabled]="chatForm.invalid || loading"
        class="p-3 text-white bg-green-600 rounded-lg disabled:bg-gray-400 enabled:hover:bg-green-700">
        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
        </svg>
      </button>
    </form>
  </div>
</div>